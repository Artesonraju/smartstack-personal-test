---
services:
  zookeeper:
    discovery:
      method: "zookeeper"
      path:  "/nerve/services/zookeeper/services"
      hosts:
        - "localhost:5200"
    haproxy:
      port: 2181
      server_options: "check inter 2000 rise 3 fall 2"
      listen:
        - "mode tcp"
  riemann_tcp:
    discovery:
      method: "zookeeper"
      path:  "/nerve/services/riemann/tcp/services"
      hosts:
        - "localhost:5200"
    haproxy:
      port: 5555
      server_options: "check inter 2000 rise 3 fall 2"
      listen:
        - "mode tcp"
  riemann_ws:
    discovery:
      method: "zookeeper"
      path:  "/nerve/services/riemann/ws/services"
      hosts:
        - "localhost:5200"
    haproxy:
      port: 5556
      server_options: "check inter 2000 rise 3 fall 2"
      listen:
        - "mode http"
      backend:
        - "option forwardfor"
  riemann_dash:
    discovery:
      method: "zookeeper"
      path:  "/nerve/services/riemann-dash/services"
      hosts: 
        - "localhost:5200"
    haproxy:
      port: 4567
      server_options: "check inter 2000 rise 3 fall 2"
      listen:
        - "mode http"
haproxy:
  bind_address: "0.0.0.0"
  reload_command: "service haproxy reload"
  config_file_path: "/etc/haproxy/haproxy.cfg"
  do_writes: true,
  do_reloads: true,
  global:
    - "maxconn 10000"
    - "stats socket /tmp/haproxy"
    - "user haproxy"
    - "group haproxy"
  defaults:
    - "log global"
    - "balance roundrobin"
    - "timeout client          50s"
    - "timeout connect          5s"
    - "timeout server          50s"
    - "timeout tunnel        3600s"
    - "timeout http-keep-alive  1s"
    - "timeout http-request    15s"
    - "timeout queue           30s"
    - "timeout tarpit          60s"
  extra_sections:
    listen stats 0.0.0.0:9000 :
      - "mode http"
      - "stats enable"
      - "stats uri /"